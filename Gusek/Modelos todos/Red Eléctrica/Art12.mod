/*CONJUNTOS*/
set N:={0..11};
set T:={1..24};
set F{n in  N};
set B{n  in N};

/*PARÁMETROS*/
param u{i in {1,2,3,8}, t in T};
param r{i in {2,3,8}, t in T};
param c{i in {1,2,3,8}, t in T};
param k{i in {1,2,3,8}, t in T};
param d{t in T};
param p{t in T};
param s{i in {2,3}, t in T};
param I_MAX := 4000;

/*VARIABLES*/
var x{i in N, j in N, t in T: i in B[j] and j in F[i]}, >=0;
var y{i in {1,2,3,8}, t in T}, binary;
var I{t in {0} union T}, >= 0;

/*FUNCIÓN OBJETIVO*/
minimize FO: sum{t in T}( sum{i in {1,2,3,8}}k[i,t]*y[i,t] + sum{i in {1,2,3}}c[i,t]*x[0,i,t] + c[8,t]*x[7,8,t] - p[t]*x[9, 11,t]);

/*RESTRICCIONES*/
# Energía acumulada inicial
s.t. rest0: I[0] = 1000;

# Transition nodes
s.t. rest1{i in {1,4,5,6,7,9},t in T}: sum{j in B[i]}x[j,i,t] - sum{j in F[i]}x[i,j,t] = 0;

# Demand node
s.t. rest2{t in T}: sum{j in B[11]} x[j,10,t] = d[t];

# Transition nodes with loss function
s.t. rest3{i in {2,3}, t in T}: r[i,t] * sum{j in B[i]}x[j,i,t] = sum{j in F[i]}x[i,j,t];

# Transition nodes with loss function
s.t. rest4{t in T:t>1}: r[8,t] * x[7,8,t] + I[t-1] = x[8,9,t] + I[t];
s.t. rest5: r[8,1] * x[7,8,1] + I[0] = x[8,9,1] + I[1];

# Battery node
s.t. rest6{i in {1,2,3},t in T}: x[0,i,t] <= u[i,t] * y[i,t];
s.t. rest7{t in T}: x[7,8,t] <= u[8,t] * y[8,t];

# cap de la bateria
s.t. rest8{t in T}: I[t] <= I_MAX;

solve;

printf: "\nRESULTADOS";
printf: "\n---------------------- \n";
printf: "\n\nFunción Objetivo: "&round(FO,2)&"\n";
for{t in T}{
	printf: "\nEn el periodo "&t&":\n";
	printf: "---------------------- \n";
	printf: "Se compran "&x[1,4,t]&" kws de energia de la red central\n";
	printf: "Se compran "&x[2,5,t]&" kws de energia de la fuente eléctrica\n";
	printf: "Se compran "&x[3,6,t]&" kws de energia de la fuente solar\n";
	printf: "Se acumulan "&I[t]&" kws de energia en la batería\n";
	printf: "Entran "&x[8,9,t]+x[4,9,t]+x[5,9,t]+x[6,9,t]&" kws de energia a la instalacion eléctrica\n";
	printf: "Se venden "&x[9,11,t]&" kws de energía en exceso\n";
}

data;
set F[0]:=1 2 3;
set F[1]:=4;
set F[2]:=5;
set F[3]:=6;
set F[4]:=7 9;
set F[5]:=7 9;
set F[6]:=7 9;
set F[7]:=8;
set F[8]:=9;
set F[9]:=10 11;
set F[10]:=;
set F[11]:=;

set B[0]:=;
set B[1]:=0;
set B[2]:=0;
set B[3]:=0;
set B[4]:=1;
set B[5]:=2;
set B[6]:=3;
set B[7]:=4 5 6;
set B[8]:=7;
set B[9]:=4 5 6 8;
set B[10]:=9;
set B[11]:=9;

param u:=
1	1	140
1	2	140
1	3	140
1	4	140
1	5	140
1	6	140
1	7	140
1	8	140
1	9	140
1	10	140
1	11	140
1	12	140
1	13	140
1	14	140
1	15	140
1	16	140
1	17	140
1	18	140
1	19	140
1	20	140
1	21	140
1	22	140
1	23	140
1	24	140
2	1	800
2	2	800
2	3	800
2	4	800
2	5	800
2	6	800
2	7	800
2	8	800
2	9	800
2	10	800
2	11	800
2	12	800
2	13	800
2	14	800
2	15	800
2	16	800
2	17	800
2	18	800
2	19	800
2	20	800
2	21	800
2	22	800
2	23	800
2	24	800
3	1	350
3	2	350
3	3	350
3	4	350
3	5	350
3	6	350
3	7	350
3	8	350
3	9	350
3	10	350
3	11	350
3	12	350
3	13	350
3	14	350
3	15	350
3	16	350
3	17	350
3	18	350
3	19	350
3	20	350
3	21	350
3	22	350
3	23	350
3	24	350
8	1	600
8	2	600
8	3	600
8	4	600
8	5	600
8	6	600
8	7	600
8	8	600
8	9	600
8	10	600
8	11	600
8	12	600
8	13	600
8	14	600
8	15	600
8	16	600
8	17	600
8	18	600
8	19	600
8	20	600
8	21	600
8	22	600
8	23	600
8	24	600;

param r:=
2	1	0.85
2	2	0.85
2	3	0.85
2	4	0.85
2	5	0.85
2	6	0.85
2	7	0.85
2	8	0.85
2	9	0.85
2	10	0.85
2	11	0.85
2	12	0.85
2	13	0.85
2	14	0.85
2	15	0.85
2	16	0.85
2	17	0.85
2	18	0.85
2	19	0.85
2	20	0.85
2	21	0.85
2	22	0.85
2	23	0.85
2	24	0.85
3	1	0.4
3	2	0.4
3	3	0.4
3	4	0.4
3	5	0.4
3	6	0.4
3	7	0.4
3	8	0.4
3	9	0.4
3	10	0.4
3	11	0.4
3	12	0.4
3	13	0.4
3	14	0.4
3	15	0.4
3	16	0.4
3	17	0.4
3	18	0.4
3	19	0.4
3	20	0.4
3	21	0.4
3	22	0.4
3	23	0.4
3	24	0.4
8	1	0.9
8	2	0.9
8	3	0.9
8	4	0.9
8	5	0.9
8	6	0.9
8	7	0.9
8	8	0.9
8	9	0.9
8	10	0.9
8	11	0.9
8	12	0.9
8	13	0.9
8	14	0.9
8	15	0.9
8	16	0.9
8	17	0.9
8	18	0.9
8	19	0.9
8	20	0.9
8	21	0.9
8	22	0.9
8	23	0.9
8	24	0.9;

param c:=
1	1	0.09
1	2	0.09
1	3	0.09
1	4	0.09
1	5	0.09
1	6	0.09
1	7	0.09
1	8	0.09
1	9	0.09
1	10	0.09
1	11	0.09
1	12	0.09
1	13	0.09
1	14	0.09
1	15	0.09
1	16	0.09
1	17	0.09
1	18	0.09
1	19	0.09
1	20	0.09
1	21	0.09
1	22	0.09
1	23	0.09
1	24	0.09
2	1	0.05
2	2	0.05
2	3	0.05
2	4	0.05
2	5	0.05
2	6	0.05
2	7	0.05
2	8	0.05
2	9	0.05
2	10	0.05
2	11	0.05
2	12	0.05
2	13	0.05
2	14	0.05
2	15	0.05
2	16	0.05
2	17	0.05
2	18	0.05
2	19	0.05
2	20	0.05
2	21	0.05
2	22	0.05
2	23	0.05
2	24	0.05
3	1	0.01
3	2	0.01
3	3	0.01
3	4	0.01
3	5	0.01
3	6	0.01
3	7	0.01
3	8	0.01
3	9	0.01
3	10	0.01
3	11	0.01
3	12	0.01
3	13	0.01
3	14	0.01
3	15	0.01
3	16	0.01
3	17	0.01
3	18	0.01
3	19	0.01
3	20	0.01
3	21	0.01
3	22	0.01
3	23	0.01
3	24	0.01
8	1	0.005
8	2	0.005
8	3	0.005
8	4	0.005
8	5	0.005
8	6	0.005
8	7	0.005
8	8	0.005
8	9	0.005
8	10	0.005
8	11	0.005
8	12	0.005
8	13	0.005
8	14	0.005
8	15	0.005
8	16	0.005
8	17	0.005
8	18	0.005
8	19	0.005
8	20	0.005
8	21	0.005
8	22	0.005
8	23	0.005
8	24	0.005;

param k:=
1	1	0.09
1	2	0.09
1	3	0.09
1	4	0.09
1	5	0.09
1	6	0.09
1	7	0.09
1	8	0.09
1	9	0.132
1	10	0.132
1	11	0.132
1	12	0.132
1	13	0.132
1	14	0.132
1	15	0.132
1	16	0.132
1	17	0.132
1	18	0.132
1	19	0.09
1	20	0.09
1	21	0.09
1	22	0.09
1	23	0.09
1	24	0.09
2	1	1
2	2	1
2	3	1
2	4	1
2	5	1
2	6	1
2	7	1
2	8	1
2	9	1
2	10	1
2	11	1
2	12	1
2	13	1
2	14	1
2	15	1
2	16	1
2	17	1
2	18	1
2	19	1
2	20	1
2	21	1
2	22	1
2	23	1
2	24	1
3	1	0.37
3	2	0.37
3	3	0.37
3	4	0.37
3	5	0.37
3	6	0.37
3	7	0.37
3	8	0.37
3	9	0.37
3	10	0.37
3	11	0.37
3	12	0.37
3	13	0.37
3	14	0.37
3	15	0.37
3	16	0.37
3	17	0.37
3	18	0.37
3	19	0.37
3	20	0.37
3	21	0.37
3	22	0.37
3	23	0.37
3	24	0.37
8	1	0.5
8	2	0.5
8	3	0.5
8	4	0.5
8	5	0.5
8	6	0.5
8	7	0.5
8	8	0.5
8	9	0.5
8	10	0.5
8	11	0.5
8	12	0.5
8	13	0.5
8	14	0.5
8	15	0.5
8	16	0.5
8	17	0.5
8	18	0.5
8	19	0.5
8	20	0.5
8	21	0.5
8	22	0.5
8	23	0.5
8	24	0.5;

param d:=
1	800
2	800
3	800
4	800
5	800
6	800
7	1100
8	1100
9	1100
10	1100
11	1100
12	1100
13	1100
14	1100
15	1100
16	1100
17	1100
18	1100
19	800
20	800
21	800
22	800
23	800
24	800;

param p:=
1	0.07
2	0.07
3	0.07
4	0.07
5	0.07
6	0.07
7	0.07
8	0.082
9	0.082
10	0.082
11	0.082
12	0.082
13	0.082
14	0.082
15	0.082
16	0.082
17	0.082
18	0.07
19	0.07
20	0.07
21	0.07
22	0.07
23	0.07
24	0.07;

param s:=
2	1	200
2	2	200
2	3	200
2	4	200
2	5	200
2	6	200
2	7	200
2	8	200
2	9	200
2	10	200
2	11	200
2	12	200
2	13	200
2	14	200
2	15	200
2	16	200
2	17	200
2	18	200
2	19	200
2	20	200
2	21	200
2	22	200
2	23	200
2	24	200
3	1	0
3	2	0
3	3	0
3	4	0
3	5	0
3	6	0
3	7	0
3	8	0
3	9	100
3	10	100
3	11	100
3	12	100
3	13	100
3	14	100
3	15	100
3	16	100
3	17	100
3	18	0
3	19	0
3	20	0
3	21	0
3	22	0
3	23	0
3	24	0;

end;